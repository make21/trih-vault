# The Rest Is History Explorer — UI PRD (v1)

Last updated: 2025-11-11  

---

## 1. Product Snapshot

**Goal**  
Make it effortless to “see the show as history”: a mobile-first vertical timeline for browsing, fast full-text search for discovery, and clean deep links to each series or episode.

**Primary Users**
- *Die-hard listeners* — recall favourite arcs, browse multi-part series, jump to specific instalments.
- *New listeners* — discover an approachable starting arc without endless podcast-app scrolling.

**Success Metrics (first 2 weeks post-launch)**
- ≥50% of sessions scroll past three decade markers on the timeline.
- ≥25% of sessions use search.
- ≥20% of sessions click through to a series or episode detail view.
- ≥5% share click-through rate from Twitter/OG previews (baseline for later OG image work).

---

## 2. Scope

**In v1**
- Mobile-first vertical timeline on `/` combining `public/series.json` and `public/episodes.json`.
- Undated items discoverable via a dedicated “Undated / Special” chip plus a supplemental list when browsing “All Eras.”
- Mixed client-side search (episodes + series) with People/Places facet chips (no type filter).
- Series detail pages (`/series/[slug]`) with narrative summaries and part lists.
- Episode detail pages (`/episode/[slug]`) with audio playback and people/places chips (no breadcrumbs).
- Deterministic slugs emitted during composition, plus `public/slug-registry.json`.
- Canonical URLs, sitemap, robots.txt, JSON-LD metadata, GA4 event instrumentation.
- Twitter/OG summary card (no custom image in v1).
- Local-only admin console at `/review` (hidden from crawlers) that lists unresolved LLM proposals and lets editors accept, reject, or map them without touching JSON files. Actions write directly to the registries and review log.

**Out of Scope (defer or post-v1)**
- Rich OG images.
- Server-side or hosted search engine.
- Advanced filters (themes, regions, timelines).
- Apple/Spotify canonical links (fallback to store search URLs).
- Personalized recommendations.

---

## 3. Data Inputs & Determinism

**`public/episodes.json`** (sorted by `publishedAt`)  
Fields: `id`, `slug`, `cleanTitle`, `cleanDescriptionText`, `audioUrl`, `keyPeople[]`, `keyPlaces[]`, `keyThemes[]`, `keyTopics[]`, `seriesId`, `yearFrom`, `yearTo`, `part`.

**`public/series.json`** (sorted by first member date)  
Fields: `id`, `slug`, `seriesTitle`, `narrativeSummary`, `episodeCount`, `episodeIds[]`, `yearFrom`, `yearTo`.

**`public/slug-registry.json`**  
Map of `{ [slug]: { type: "episode" | "series", id } }` produced by the composer. Enforces global slug uniqueness.

Composition ensures slugs are deterministic and consistent across runs; registry collisions are resolved predictably.

---

## 4. Information Architecture & Routing

| Route | Purpose | Notes |
| --- | --- | --- |
| `/` | Timeline home | Mobile-first vertical spine with sticky decade markers. |
| `/series/[slug]` | Series detail | Narrative, year span chip, ordered list of parts. |
| `/episode/[slug]` | Episode detail | Title, part badge, audio player, chips, description. |
| `/people/[slug]` | Person entity page | Quick facts + chronological or grouped list of appearances. |
| `/places/[slug]` | Place entity page | Mirrors person layout with type labels and contextual notes. |
| `/topics/[slug]` | Topic entity page | Focused narrative around curated registry topics. |
| `/about` | About the project | Unofficial fan-story + motivation; repeats “not affiliated” disclaimer. |
| `/privacy` | Privacy policy | Plain-language summary of logging/analytics (none) and contact note. |
| `/terms` | Terms of service | Lightweight usage guidelines and fan-site disclaimer. |

Series pages link to their constituent episodes via `/episode/[episodeSlug]`. Entity pages round out the IA so every pill link has a deterministic destination; no nested routes in v1.

---

## 5. Slug Strategy (Programmatic, Deterministic)

Slugs are generated by deterministic helpers so any two runs over the same artefacts yield identical outputs. All logic follows the V7 rules shared with engineering:

- **Shared helper** — `slugify(text)` transliterates accents, lowercases, strips punctuation (preserving intra-word hyphens), removes stop words, and returns hyphenated tokens without truncating. Token budgeting happens in the calling strategy.
- **Series slugs** — `series.seriesTitle` is slugified; we keep the first four tokens (fallback to `seriesId` fragments if the title reduces to nothing). Example: `The French Revolution: From Versailles to the Rights of Man` → `french-revolution-versailles-rights`.
- **Episode slugs (standalone)** — Drop numeric prefixes and part labels from `cleanTitle`, slugify the remainder, and keep up to four tokens (fallback to UUID fragments if empty).
- **Episode slugs (series members)** — Combine:
  1. A **series handle**: first token in the parent series slug not present in the domain-topic list; fallback concatenates the first two tokens or uses the seriesId prefix.
  2. Up to **two subtitle tokens** from the episode (text after the first colon, or the full title if no colon).
  3. An optional **`ptN`** token when `part` is provided (no year fallback).
  Total tokens never exceed four; if adding `ptN` would exceed the limit, we drop the last subtitle token.
- **Collisions** — The slug registry builder appends stable numeric suffixes (`-2`, `-3`, …) when duplicates occur and persists those assignments.

Composer (or the registry build step) writes the resolved slugs onto artefacts and updates `public/slug-registry.json` atomically.

---

## 6. Timeline Experience (Home)

- **Hero & palette** — Parchment (#F8F6F3) background with oxblood (#6A1F1B) headline, serif typography, subtle radial gradients.
- **Utility bar** — Slim beige strip pinned to the top with a contextual primary link (“Latest episode: …” on home, “← Timeline” elsewhere) plus the global search trigger (hidden on the homepage since the hero already features the omnibox). Keep it responsive and avoid double-search affordances on the landing page.
- **Latest Episode banner** — Beige capsule with clock icon, published date, CTA to the latest `/episode` slug. Fully keyboard-accessible.
- **Era chips** — Rounded pills in beige/oxblood. Options: All Eras, Prehistory, Ancient World, Late Antiquity & Early Middle Ages, High Middle Ages, Early Modern, Long 19th Century, 20th Century, 21st Century, Undated / Special. Chips update the `?era=` query param without a reload and preserve scroll position.
- **Timeline spine** — Stays centered on all breakpoints. Series and episode markers share the same axis; series markers use the secondary tint.
- **Cards** — Floating cards with parchment styling. Series cards include a “Series” pill, beige background, and collapsible part list; episodes stay white. Hover/focus lifts the card slightly.
- **Gap markers** — Collapsible dotted buttons with textual labels (“Gap of 642 years”). Expanded state stored per ID.
- **Undated / Special** — Selecting the undated chip shows the non-chronological drawer; otherwise, the drawer appears under the main timeline when viewing “All Eras.”
- **Ordering** — Series sorted by `yearFrom`/`yearTo` (ties by title). Standalone episodes sorted by `yearFrom`/`yearTo` then `cleanTitle`. Undated rows ordered by `publishedAt`.
- **Accessibility** — Chips expose `aria-pressed`, gap markers announce skipped years, cards retain visible focus rings. Contrasts adhere to WCAG AA.
- **BC labelling** — Negative `yearFrom`/`yearTo` render with `BC` suffixes (e.g. “264 BC – 216 BC”).

---

## 7. Visual System (Brand Palette)

- **Colors**
  - Background: parchment `#F8F6F3`.
  - Primary text: `#2A2522`.
  - Primary accent: oxblood `#6A1F1B` (hover `#8C2B24`).
  - Secondary accent: tan `#B89464` (hover `#D3B785`).
  - Cards: `#FFFFFF` / `#F2E4D4` (series tint).
  - Borders: `rgba(42, 37, 34, 0.12)`.
- **Typography**
  - Headlines: “Source Serif 4” (or Georgia fallback) with oxblood color.
  - Body copy: Inter/System stack in dark brown.
- **Texture**
  - Optional radial gradient overlays evoke parchment; no heavy illustrations in the current pass.
- **Components**
  - Pills, banners, chips, and quick-fact cards all reuse the palette above. Audio player uses the same card treatment for brand consistency.
- QA on mobile and desktop to verify performance, contrast, and scroll behaviour.

---

## 8. Search Experience (See `docs/PRD-Search.md`)

Search now has its own canonical PRD in `docs/PRD-Search.md`, which specifies the MiniSearch index builder, entity inclusion, GA instrumentation, SEO guardrails, and success metrics. This UI document simply references that spec to avoid duplication. Until the feature ships, the timeline and entity detail pages continue to provide the primary browse pathways.

---

## 9. Detail Views

**Episode**
- Title + optional “Part N” badge (hidden when standalone).
- People, Places, and Topics chips (linking back to filtered search in post-v1 roadmap; topics use curated labels from the registry).
- Summary: short teaser (~160–200 chars) above the fold; full clean description below.
- Embedded HTML5 audio player (`<audio controls src={audioUrl}>`).
- Breadcrumb to series (if applicable) and prev/next navigation within the same series.

**Series**
- Title, narrative summary, episode count, optional year-span chip.
- Ordered list of parts with publication years and part badges; child rows link to episode detail pages.
- CTA to scroll timeline back to the series position (deep link anchor).

**People / Places / Topics**
- Share the dedicated `EntityLayout` hero: oxblood serif title, optional subtitle, parchment card background, automatic compact padding when no subtitle is available so sparse entities do not leave an empty billboard.
- Quick Facts block (first/latest appearance links, year range, entity-specific metadata) sits directly under the hero.
- Entity episodes component lists every mention with toggleable grouping (chronological pagination vs. grouped by series) and `EpisodeCard` styling.
- Chips route to `/people/[slug]`, `/places/[slug]`, `/topics/[slug]` so the browse loop is closed without relying on unfinished search.

**About / Privacy / Terms**
- Use `StaticPageLayout` — condensed serif hero without the entity card, stacked prose content, and compact “Back to timeline” pill. Copy stays generic (no personal names) and reinforces the unofficial fan-project disclaimer.

Accessibility: provide `aria-expanded` for collapsible sections, descriptive button labels, and ensure screen-reader ordering follows the visual layout.

---

## 10. SEO & Sharing

- Canonical URL per page (`/episode/[slug]`, `/series/[slug]`, `/people/[slug]`, `/places/[slug]`, `/topics/[slug]`).
- `twitter:card=summary` (no image in v1).
- Open Graph:
  - `og:title`: `The Rest Is History — {cleanTitle}` or `TRIH Series — {seriesTitle}`.
  - `og:description`: first high-quality sentence (≤160 characters).
- JSON-LD:
  - Episodes as `PodcastEpisode` with `partOfSeries`.
  - Series as `CreativeWorkSeries`.
  - People as `Person`, places as `Place`, topics as `DefinedTerm` (or `Thing` when taxonomy is broader) with `subjectOf` pointing back to related episodes.
  - Static pages (`/about`, `/privacy`, `/terms`) share standard metadata only (no JSON-LD required).
- `robots.txt` allows all crawlers.
- Sitemap generated from `public/slug-registry.json` either during publish or via `/sitemap.xml`.

---

## 11. Performance & Technical Notes

- Timeline currently imports `public/episodes.json`/`public/series.json` at build time, so no client fetch is required; updates flow through the pipeline-generated artefacts.
- Entity detail routes call `get*StaticSlugs()` (derived from registry files + artefacts) inside `generateStaticParams`, keeping pre-render deterministic and avoiding runtime filesystem reads.
- Once search ships, trim the client index payload (only store fields required for search) to keep bundle sizes manageable.
- Static generation with Incremental Static Regeneration (ISR):
  - Detail pages revalidate on the cadence Vercel config specifies, or use on-demand revalidation triggered by the publish workflow.
- Long-cache immutable assets; bust via filename hashing when necessary.
- Target Core Web Vitals budgets; avoid layout shift by reserving space for timeline elements.

---

## 12. Analytics (GA4)

- `timeline_scroll_depth` (25 / 50 / 75% markers).
- `search_submit` and `search_result_click`.
- `filter_chip_click` (People/Places).
- `open_series`, `open_episode`.
- `audio_play`.

Integrate via GA4 gtag events with consistent parameters (`content_type`, `content_id`, etc.).

---

## 13. Build & Deploy (Vercel)

- Next.js App Router, static-friendly architecture.
- ISR or on-demand revalidation for detail pages.
- Scheduled GitHub Actions pipeline commits refreshed JSON artefacts to `main`, then calls the Vercel revalidation webhook; deployments pick up changes automatically.
- Ensure environment variables (GA4 measurement ID, etc.) are provisioned in Vercel.
- Monitor build size and ensure JSON artefacts remain below Vercel’s 10 MB edge limit per file.

---

## 14. v1 Ship Checklist

- [ ] Composer emits slugs for all episodes/series and writes `public/slug-registry.json`.
- [ ] Timeline home (`/`) with expandable series and undated section.
- [ ] Entity destinations for series, episodes, people, places, topics share consistent LayoutDetail experience.
- [ ] Static footer with fan disclaimer + quick links to key pages (about/privacy/terms/featured entities).
- [ ] Search backlog scoped and captured (section 8) for the next milestone.
- [ ] Canonicals, sitemap/robots, JSON-LD metadata (episodes/series/entities).
- [ ] GA4 events wired for timeline + detail interactions (search events deferred until feature launch).
- [ ] ISR/on-demand revalidation path documented and integrated with pipeline.
- [ ] Smoke tests on mobile viewports and screen readers (VoiceOver/NVDA).

---

## 15. Risks & Mitigations

- **Large JSON payloads** — mitigate via virtualised lists and trimmed search index; escalate to server-driven search if growth demands.
- **Missing year ranges** — dedicated “Undated” section keeps ordering deterministic; consider LLM-assisted backfill in future iterations.
- **Slug collisions** — `slug-registry.json` and deterministic resolver enforce uniqueness; add unit tests around collision cases.
- **Asset-less sharing** — rely on text-only summary card for v1; roadmap includes `/api/og` endpoint for richer previews.

---

## 16. Roadmap (Post-v1)

1. Dynamic OG image endpoint (`/api/og`) for richer link previews.
2. Additional filters (themes, regions) and chip-linking from detail pages.
3. Server-side search (Meilisearch/Typesense) if dataset outgrows client index.
4. Apple/Spotify canonical link resolver service.
5. Timeline “mini-map”, random episode button, lightweight favourites (local storage).

---

## 17. Open Questions

- Who owns ongoing GA4 analysis and reporting post-launch?
- Do we need a privacy notice or cookie banner when GA4 goes live?
- Should undated items also surface an inferred year if LLM enrichment suggests one?
- What is the minimum acceptable accessibility score (e.g., Lighthouse ≥90) before launch?
